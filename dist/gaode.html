<!doctype html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no, width=device-width">
    <style>html,
    body,
    #container {
      width: 100%;
      height: 100%;
    }</style>
    <title>POLYGON TEST</title>
    <link rel="stylesheet" href="https://a.amap.com/jsapi_demos/static/demo-center/css/demo-center.css">
    
 </head>
<body>
<div id="container"></div>
<div class="nav-card" style="width: 120px;position:fixed;top:10px;left:10px;width:200px;">
  <input id="searchCity" onkeyup="handlekeyup(event)" placeholder="输入城市或POI名">
  <button class="btn" style="background:#fff" onclick="search()"> GOTO </button>
</div>
<div class="input-card" style="width: 120px">
   <button class="btn" onclick="restart()" style="margin-bottom: 5px">初始化多边形</button> 
   <button class="btn" onclick="polyEditor.open()" style="margin-bottom: 5px;display:none">开始编辑</button> 
   <button class="btn" onclick="polyEditor.close();" style="display:none;">结束编辑</button> 
</div>
<div style="position:fixed;bottom:20px;left:10px;">
  <textarea style="width:200px;height:60px;font-size:9px;" id="polygondata"></textarea>
</div>
<script>var params = new Proxy(new URLSearchParams(window.location.search), {
  get: function get(searchParams, prop) {
    return searchParams.get(prop);
  }
});

function writeScript(url) {
  document.write("<script " + "type=\"text/javascript\"\n  src=\"".concat(url, "\"></") + "script>");
}

if (params.gaodejskey) {
  writeScript("https://webapi.amap.com/maps?v=1.4.15&key=".concat(params.gaodejskey, "&plugin=AMap.PolyEditor,AMap.PlaceSearch"));
  writeScript("https://cache.amap.com/lbs/static/PlaceSearchRender.js");
  writeScript("https://a.amap.com/jsapi_demos/static/demo-center/js/demoutils.js");
} else {
  document.body.innerHTML = "gaodejskey is empty, please define it on querystring by visiting http://localhost:1234/?gaodejskey=xxxx";
}</script>
<script>function _slicedToArray(arr, i) { return _arrayWithHoles(arr) || _iterableToArrayLimit(arr, i) || _nonIterableRest(); }

function _nonIterableRest() { throw new TypeError("Invalid attempt to destructure non-iterable instance"); }

function _iterableToArrayLimit(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i["return"] != null) _i["return"](); } finally { if (_d) throw _e; } } return _arr; }

function _arrayWithHoles(arr) { if (Array.isArray(arr)) return arr; }

if (!params.gaodejskey) throw new Error("no gaodejskey founded"); // https://lbs.amap.com/api/javascript-api/guide/overlays/vector-overlay#polygon

var map = new AMap.Map("container", {
  center: [116.399245, 39.917267],
  zoom: 14
});
var path = [[116.403322, 39.920255], [116.410703, 39.897555], [116.402292, 39.892353], [116.389846, 39.891365]];
var polygon = new AMap.Polygon({
  path: path,
  strokeColor: "#FF33FF",
  strokeWeight: 6,
  strokeOpacity: 0.2,
  fillOpacity: 0.4,
  fillColor: '#1791fc',
  zIndex: 50
});
window.polygon = polygon;
window.map = map;
map.add(polygon); // 缩放地图到合适的视野级别

map.setFitView([polygon]);
var polyEditor = new AMap.PolyEditor(map, polygon);
polyEditor.on('end', function (event) {
  log.info('触发事件： end');
  console.log(event.target);
});
polyEditor.on('adjust', function () {
  setTimeout(sync, 100);
});
setTimeout(function () {
  restart();
  sync();
  polyEditor.open();
}, 100);

function sync() {
  var _map$getCenter = map.getCenter(),
      lat = _map$getCenter.lat,
      lng = _map$getCenter.lng;

  document.getElementById('polygondata').value = 'POLYGON:' + polygon.getPath().map(function (x) {
    return x.lng + ',' + x.lat;
  }).join(';') + '@' + lng + ',' + lat;
}

window.search = function () {
  var text = document.getElementById('searchCity').value.trim();

  var _text$split = text.split(/\s+/),
      _text$split2 = _slicedToArray(_text$split, 2),
      city = _text$split2[0],
      poi = _text$split2[1];

  console.log({
    city: city,
    poi: poi
  });
  var placeSearch = new AMap.PlaceSearch({
    city: city
  });
  placeSearch.search(poi || city, function (status, result) {
    var firstPOI = result.poiList && result.poiList.count ? result.poiList.pois[0] : null;
    if (!firstPOI) return alert("找不找你要的地方，写详细点");
    map.setCenter([firstPOI.location.lng, firstPOI.location.lat]);
  });
};

window.handlekeyup = function (e) {
  if (e.keyCode === 13) return search();
};

window.restart = function () {
  var _map$getCenter2 = map.getCenter(),
      lat = _map$getCenter2.lat,
      lng = _map$getCenter2.lng;

  var offset = 0.01;
  polygon.setPath([[lng - offset, lat - offset], [lng + offset, lat - offset], [lng + offset, lat + offset], [lng - offset, lat + offset]]);
};</script>
</body>
</html>
